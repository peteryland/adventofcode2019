#include "intcode.h"

#define NUMPERMS 120
word perms[120][5] = {
  {0,1,2,3,4} ,{1,0,2,3,4} ,{2,1,0,3,4} ,{1,2,0,3,4} ,{2,0,1,3,4} ,{0,2,1,3,4} ,{3,2,1,0,4} ,{2,3,1,0,4},
  {2,1,3,0,4} ,{3,1,2,0,4} ,{1,3,2,0,4} ,{1,2,3,0,4} ,{3,0,1,2,4} ,{0,3,1,2,4} ,{0,1,3,2,4} ,{3,1,0,2,4},
  {1,3,0,2,4} ,{1,0,3,2,4} ,{3,0,2,1,4} ,{0,3,2,1,4} ,{0,2,3,1,4} ,{3,2,0,1,4} ,{2,3,0,1,4} ,{2,0,3,1,4},
  {4,3,2,1,0} ,{3,4,2,1,0} ,{3,2,4,1,0} ,{3,2,1,4,0} ,{4,2,3,1,0} ,{2,4,3,1,0} ,{2,3,4,1,0} ,{2,3,1,4,0},
  {4,1,2,3,0} ,{1,4,2,3,0} ,{1,2,4,3,0} ,{1,2,3,4,0} ,{4,2,1,3,0} ,{2,4,1,3,0} ,{2,1,4,3,0} ,{2,1,3,4,0},
  {4,1,3,2,0} ,{1,4,3,2,0} ,{1,3,4,2,0} ,{1,3,2,4,0} ,{4,3,1,2,0} ,{3,4,1,2,0} ,{3,1,4,2,0} ,{3,1,2,4,0},
  {4,0,1,2,3} ,{0,4,1,2,3} ,{0,1,4,2,3} ,{0,1,2,4,3} ,{4,1,0,2,3} ,{1,4,0,2,3} ,{1,0,4,2,3} ,{1,0,2,4,3},
  {4,1,2,0,3} ,{1,4,2,0,3} ,{1,2,4,0,3} ,{1,2,0,4,3} ,{4,0,2,1,3} ,{0,4,2,1,3} ,{0,2,4,1,3} ,{0,2,1,4,3},
  {4,2,0,1,3} ,{2,4,0,1,3} ,{2,0,4,1,3} ,{2,0,1,4,3} ,{4,2,1,0,3} ,{2,4,1,0,3} ,{2,1,4,0,3} ,{2,1,0,4,3},
  {4,0,3,2,1} ,{0,4,3,2,1} ,{0,3,4,2,1} ,{0,3,2,4,1} ,{4,3,0,2,1} ,{3,4,0,2,1} ,{3,0,4,2,1} ,{3,0,2,4,1},
  {4,3,2,0,1} ,{3,4,2,0,1} ,{3,2,4,0,1} ,{3,2,0,4,1} ,{4,0,2,3,1} ,{0,4,2,3,1} ,{0,2,4,3,1} ,{0,2,3,4,1},
  {4,2,0,3,1} ,{2,4,0,3,1} ,{2,0,4,3,1} ,{2,0,3,4,1} ,{4,2,3,0,1} ,{2,4,3,0,1} ,{2,3,4,0,1} ,{2,3,0,4,1},
  {4,0,3,1,2} ,{0,4,3,1,2} ,{0,3,4,1,2} ,{0,3,1,4,2} ,{4,3,0,1,2} ,{3,4,0,1,2} ,{3,0,4,1,2} ,{3,0,1,4,2},
  {4,3,1,0,2} ,{3,4,1,0,2} ,{3,1,4,0,2} ,{3,1,0,4,2} ,{4,0,1,3,2} ,{0,4,1,3,2} ,{0,1,4,3,2} ,{0,1,3,4,2},
  {4,1,0,3,2} ,{1,4,0,3,2} ,{1,0,4,3,2} ,{1,0,3,4,2} ,{4,1,3,0,2} ,{1,4,3,0,2} ,{1,3,4,0,2} ,{1,3,0,4,2}
};

word tryperm(state *s0, word *ps) {
  state *states[] = {0, 0, 0, 0, 0};
  word x = 0;

  for (int i = 0; i < 5; i++) {
    state *s = states[i];
    if (s == 0) s = states[i] = copystate(s0);
    runinput(s, ps[i]);
    runinput(s, x);
    x = s->output;
  }
  return x;
}

int main() {
  state *s0 = readprog();
  word maxval = 0;

  for (int i = 0; i < NUMPERMS; i++) {
    word *ps = perms[i];
    word val = tryperm(s0, ps);
    if (val > maxval)
      maxval = val;
  }
  printf("%lld\n", maxval);
}
